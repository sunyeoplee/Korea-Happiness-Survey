---
title: "data_analysis"
author: "Sunyeop Lee"
date: '2021 7 24 '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, include=FALSE}
library(lme4)
library(nnet)
library(broom)
library(survey)
library(haven)
library(jtools)
library(remotes)

remotes::install_github("carlganz/svrepmisc")
library(svrepmisc)


options(scipen=999, digits=4)
```

```{r call relevant R scripts, include=F}
source("C:\\Users\\USER\\Desktop\\Backup\\Gap year\\Korea Happiness Survey\\Korea-Happiness-Survey\\code\\data_preparation.R")
```

```{r}
sociodemo_var
social_var
psych_var
health_var
```


```{r}
### multinomial regression ### 

# create a bootstrap replicate weight set
des <- svydesign(ids=~psu, strata=~strataid, weights=~survey_weight, data=mydata, nest=FALSE)
w <- as.svrepdesign()

model <- multinom(smoking_change_cat ~ 1 + age + sex + area + 
                    home_payment_3 + family_type_2 + income_household + employment_4 + basicincome_2 +
                    online_friends + offline_friends +  
                    # happiness + 
                    # anxiety_2 + depression_2 + apathy_2 + loneliness_2 +
                    chronic_disease_3,
                data=mydata)

model_sum <- summary(model)
print(model_sum)

model_tidy <- tidy(model, conf.int = TRUE, exponentiate = TRUE)
knitr::kable(model_tidy)

model <- multinom(alcohol_change_cat ~ 1 + age + sex + area +
                    home_payment_3 + family_type_2 + income_household + employment_4 + basicincome_2 +
                    online_friends + offline_friends + 
                    # happiness + 
                    # anxiety_2 + depression_2 + apathy_2 + loneliness_2 +
                    chronic_disease_3,
                data=mydata)

model_sum <- summary(model)
print(model_sum)

model_tidy <- tidy(model, conf.int = TRUE, exponentiate = TRUE)
knitr::kable(model_tidy)




```

```{r}

```




```{r,eval=FALSE, include=FALSE}
# multilevel regression
model <- lmer(smoking_change_cigarettes ~ 1 + age + sex +
                (1 | census) + (1 | area),
              data=mydata)
summary(model)

model <- glmer(smoking_increased ~ 1 + 
                   (1 + covid_cases| area), 
                family=binomial, data = mydata)

summary(model)

model <- glmer(alcohol_increased ~ 1 + 
                   (1 | census) + (1 | area), 
                family=binomial, data = mydata)

summary(model)

```





```{r, eval=FALSE, include=FALSE}
# scratch code

# changes in the number of cigarettes smoked
model <- glm(smoking_change_cigarettes ~ 1 + age + sex +  
                family_type_3 + home_payment_3 + employment_5 + income_household_rev, 
             family=gaussian(link = "identity"),
             data=mydata)

summary(model)




# logistic regression
model <- glm(smoking_increased ~ 1 + age + sex + area + 
                    home_payment_3 + family_type_2 + income_household + employment_4 + basicincome_2 +
                    online_friends + offline_friends +  
                    happiness + life_satisfaction +
                    anxiety_2 + worry_2 + depression_2 + apathy_2 + loneliness_2 +
                    physical_health_3 + chronic_disease_3,
             family=binomial(link='logit'), 
             data=mydata)
car::vif(model)

model_summary <- summary(model)
model_summary$coefficients / model_summary$standard.errors
model_summary$standard.errors * 2

model <- glm(alcohol_increased ~ 1 + basicincome_binary, family=binomial(link='logit'), data=mydata)
summary(model)
exp(model$coefficients)


exp(confint(model))









z <- summary(model)$coefficients / summary(model)$standard.errors
p <- (1 - pnorm(abs(z), 0, 1)) * 2
p
```





































